{"split":"1","session.current":["/Imaging/c/shotwem.c"],"session.open":{"/Imaging/c/shotwem.c":{"scrollTop":1947,"scrollLeft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"lastUse":1452641963202,"undo":[],"redo":[]},"/Imaging/ShotProfileWEM.jl":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":382,"column":22},"end":{"row":382,"column":22}},"lastUse":1452641680663,"undo":[],"redo":[]},"/Imaging/c/wem.c":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":9,"column":1},"end":{"row":9,"column":1}},"lastUse":1452641630185,"undo":[],"redo":[]},"/Solvers/ConjugateGradients.jl":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":14,"column":18},"end":{"row":14,"column":18}},"lastUse":1452641119470,"undo":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":120,"column":22},"end":{"row":120,"column":23}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":22},"end":{"row":120,"column":23}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":120,"column":25},"end":{"row":120,"column":26}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":25},"end":{"row":120,"column":26}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":120,"column":28},"end":{"row":120,"column":29}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":28},"end":{"row":120,"column":29}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":121,"column":22},"end":{"row":121,"column":23}},"text":"."}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":121,"column":21},"end":{"row":121,"column":22}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":121,"column":21},"end":{"row":121,"column":31}},"text":"[1.;1.;1.]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":122,"column":24},"end":{"row":122,"column":25}},"text":"."}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":122,"column":23},"end":{"row":122,"column":24}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":122,"column":23},"end":{"row":122,"column":33}},"text":"[1.;1.;1.]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":128,"column":23},"end":{"row":128,"column":24}},"text":"."}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":128,"column":22},"end":{"row":128,"column":23}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":22},"end":{"row":128,"column":32}},"text":"[1.;1.;1.]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":29},"end":{"row":133,"column":30}},"text":"."}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":28},"end":{"row":133,"column":29}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":28},"end":{"row":133,"column":38}},"text":"[1.;1.;1.]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":120,"column":34},"end":{"row":120,"column":39}},"text":"alpha"},{"action":"insertText","range":{"start":{"row":120,"column":34},"end":{"row":120,"column":53}},"text":"[alpha;alpha;alpha]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":121,"column":35},"end":{"row":121,"column":40}},"text":"alpha"},{"action":"insertText","range":{"start":{"row":121,"column":35},"end":{"row":121,"column":54}},"text":"[alpha;alpha;alpha]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":122,"column":37},"end":{"row":122,"column":42}},"text":"alpha"},{"action":"insertText","range":{"start":{"row":122,"column":37},"end":{"row":122,"column":56}},"text":"[alpha;alpha;alpha]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":21},"end":{"row":133,"column":25}},"text":"beta"},{"action":"insertText","range":{"start":{"row":133,"column":21},"end":{"row":133,"column":40}},"text":"[alpha;alpha;alpha]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":26},"end":{"row":133,"column":27}},"text":"a"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":25},"end":{"row":133,"column":26}},"text":"h"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":24},"end":{"row":133,"column":25}},"text":"p"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":23},"end":{"row":133,"column":24}},"text":"l"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":22},"end":{"row":133,"column":23}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":22},"end":{"row":133,"column":23}},"text":"b"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":23},"end":{"row":133,"column":24}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":24},"end":{"row":133,"column":25}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":25},"end":{"row":133,"column":26}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":31},"end":{"row":133,"column":32}},"text":"a"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":30},"end":{"row":133,"column":31}},"text":"h"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":29},"end":{"row":133,"column":30}},"text":"p"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":28},"end":{"row":133,"column":29}},"text":"l"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":27},"end":{"row":133,"column":28}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":27},"end":{"row":133,"column":28}},"text":"b"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":28},"end":{"row":133,"column":29}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":29},"end":{"row":133,"column":30}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":30},"end":{"row":133,"column":31}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":36},"end":{"row":133,"column":37}},"text":"a"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":35},"end":{"row":133,"column":36}},"text":"h"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":34},"end":{"row":133,"column":35}},"text":"p"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":33},"end":{"row":133,"column":34}},"text":"l"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":32},"end":{"row":133,"column":33}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":32},"end":{"row":133,"column":33}},"text":"b"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":33},"end":{"row":133,"column":34}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":34},"end":{"row":133,"column":35}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":35},"end":{"row":133,"column":36}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":143,"column":0},"end":{"row":206,"column":0}},"nl":"\n","lines":["","","function ConjugateGradients(m::Array{ASCIIString,1},m0::Array{ASCIIString,1},d::Array{ASCIIString,1},cost_file::ASCIIString,param::Dict{Any,Any})","\t# Conjugate Gradients following Algorithm 2 from Scales, 1987. ","\t# The user provides an array of linear operators. Ensure linear operator(s) pass the dot product.","","\tNiter = get(param,\"Niter\",10)","\tmu = get(param,\"mu\",[0. 0. 0.])","\tmu = sqrt(mu)","\toperators = get(param,\"operators\",[])","\tparam_op = copy(param)","\tcost = Float64[]","\trand_string = string(int(rand()*100000))","\tg = [join([\"tmp_CG_g1_\",rand_string]);join([\"tmp_CG_g2_\",rand_string]);join([\"tmp_CG_g3_\",rand_string])]","\ts = [join([\"tmp_CG_s1_\",rand_string]);join([\"tmp_CG_s2_\",rand_string]);join([\"tmp_CG_s3_\",rand_string])]","\trr = [join([\"tmp_CG_rr1_\",rand_string]);join([\"tmp_CG_rr2_\",rand_string]);join([\"tmp_CG_rr3_\",rand_string])]","\ttt = [join([\"tmp_CG_tt1_\",rand_string]);join([\"tmp_CG_tt2_\",rand_string]);join([\"tmp_CG_tt3_\",rand_string])]","\tr = [join([\"tmp_CG_r1_\",rand_string]);join([\"tmp_CG_r2_\",rand_string]);join([\"tmp_CG_r3_\",rand_string])]","\tt = [join([\"tmp_CG_t1_\",rand_string]);join([\"tmp_CG_t2_\",rand_string]);join([\"tmp_CG_t3_\",rand_string])]","\tSeisCopy(m0,m)","\tforward_op(m0,r,operators,param_op)","\tCGStep(r,d,{\"a\"=>[-1.;-1.;-1.],\"b\"=>[1.;1.;1.]});","\tSeisCopy(m0,rr);\t","\tCGStep(rr,m0,{\"a\"=>[0.;0.;0.],\"b\"=>-mu})","\tpush!(cost,InnerProduct(r,r) + InnerProduct(rr,rr))","\tfp = open(cost_file,\"w\")","\twrite(fp,join([\"began execution at: \",strftime(time()),\"\\n\"]))","\twrite(fp,join([string(cost[1]),\"\\n\"]))","\tclose(fp)","\tadjoint_op(g,r,operators,param_op)","\tCGStep(g,rr,{\"a\"=>[1.;1.;1.],\"b\"=>mu})","\tSeisCopy(g,s)","\t# initialize tt with zeros","\tSeisCopy(s,tt)","\tCGStep(tt,s,{\"a\"=>[0.;0.;0.],\"b\"=>[0.;0.;0.]});","\tgamma_old = InnerProduct(g,g)\t","\tfor iter = 1 : Niter\t","\t\tforward_op(s,t,operators,param_op)","\t\tCGStep(tt,s,{\"a\"=>[0.;0.;0.],\"b\"=>mu});","\t\tdelta = InnerProduct(t,t) + InnerProduct(tt,tt)","\t\talpha = gamma_old/(delta + 1.e-20)","\t\tCGStep(m,s,{\"a\"=>[1.;1.;1.],\"b\"=>[alpha;alpha;alpha]})","\t\tCGStep(r,t,{\"a\"=>[1.;1.;1.],\"b\"=>-[alpha;alpha;alpha]})","\t\tCGStep(rr,tt,{\"a\"=>[1.;1.;1.],\"b\"=>-[alpha;alpha;alpha]})","\t\tpush!(cost,InnerProduct(r,r) + InnerProduct(rr,rr))","\t\tfp = open(cost_file,\"a\")","\t\twrite(fp,join([string(cost[iter+1]),\"\\n\"]))","\t\tclose(fp)","\t\tadjoint_op(g,r,operators,param_op)","\t\tCGStep(g,rr,{\"a\"=>[1.;1.;1.],\"b\"=>mu})","\t\tgamma = InnerProduct(g,g)","\t\tbeta = gamma/(gamma_old + 1.e-20)","\t\tgamma_old = copy(gamma)","\t\tCGStep(s,g,{\"a\"=>[beta;beta;beta],\"b\"=>[1.;1.;1.]})","\tend","\tSeisRemove(g);","\tSeisRemove(s);","\tSeisRemove(rr);","\tSeisRemove(tt);","\tSeisRemove(r);","\tSeisRemove(t);","","end"]}]}]],"redo":[]},"/Utils/SeisRemove.jl":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"lastUse":1452638413803,"undo":[],"redo":[]},"/Utils/SeisCopy.jl":{"scrollTop":11,"scrollLeft":0,"selection":{"start":{"row":1,"column":0},"end":{"row":1,"column":0}},"lastUse":1452638390732,"undo":[],"redo":[]},"/Utils/LinearOperator.jl":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":94,"column":0},"end":{"row":94,"column":0}},"lastUse":1452637852278,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":12},"end":{"row":79,"column":16}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":80,"column":5},"end":{"row":80,"column":8}},"text":"   "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":80,"column":8},"end":{"row":80,"column":12}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":81,"column":1},"end":{"row":81,"column":4}},"text":"   "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":81,"column":4},"end":{"row":81,"column":8}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":82,"column":1},"end":{"row":82,"column":4}},"text":"   "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":82,"column":4},"end":{"row":82,"column":8}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":83,"column":1},"end":{"row":83,"column":4}},"text":"   "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":83,"column":4},"end":{"row":83,"column":8}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":84,"column":1},"end":{"row":84,"column":4}},"text":"   "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":84,"column":4},"end":{"row":84,"column":8}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":46},"end":{"row":77,"column":47}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":47},"end":{"row":77,"column":48}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":48},"end":{"row":77,"column":49}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":49},"end":{"row":77,"column":50}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":50},"end":{"row":77,"column":51}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":51},"end":{"row":77,"column":52}},"text":"["}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":52},"end":{"row":77,"column":53}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":52},"end":{"row":77,"column":53}},"text":"j"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":46},"end":{"row":100,"column":47}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":47},"end":{"row":100,"column":48}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":48},"end":{"row":100,"column":49}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":49},"end":{"row":100,"column":50}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":50},"end":{"row":100,"column":51}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":100,"column":50},"end":{"row":100,"column":51}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":50},"end":{"row":100,"column":51}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":51},"end":{"row":100,"column":52}},"text":"["}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":52},"end":{"row":100,"column":53}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":52},"end":{"row":100,"column":53}},"text":"j"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":70,"column":12},"end":{"row":70,"column":15}},"text":"iop"},{"action":"insertText","range":{"start":{"row":70,"column":12},"end":{"row":70,"column":13}},"text":"j"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":71,"column":27},"end":{"row":71,"column":30}},"text":"iop"},{"action":"insertText","range":{"start":{"row":71,"column":27},"end":{"row":71,"column":28}},"text":"j"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":76,"column":20},"end":{"row":76,"column":21}},"text":"j"},{"action":"insertText","range":{"start":{"row":76,"column":20},"end":{"row":76,"column":21}},"text":"k"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":29},"end":{"row":77,"column":30}},"text":"j"},{"action":"insertText","range":{"start":{"row":77,"column":29},"end":{"row":77,"column":30}},"text":"k"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":38},"end":{"row":77,"column":39}},"text":"j"},{"action":"insertText","range":{"start":{"row":77,"column":38},"end":{"row":77,"column":39}},"text":"k"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":85,"column":0},"end":{"row":91,"column":0}},"nl":"\n","lines":["       ","        ","        ","        ","        ","        "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":58,"column":0},"end":{"row":69,"column":0}},"nl":"\n","lines":["        SeisCopy(d,tmp_d)","        for j = 1 : 1 : length(operators)","            op = operators[j]","            op(tmp_m,tmp_d,true;parameters[j]...)","            SeisCopy(tmp_m,tmp_d)","        end","        SeisCopy(tmp_m,m)","        SeisRemove(tmp_m)","        SeisRemove(tmp_d)","        ","        "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":94,"column":0},"end":{"row":140,"column":0}},"nl":"\n","lines":["","function forward_op(m::Array{ASCIIString,1},d::Array{ASCIIString,1},operators,param)","    param[\"adj\"] = false","    rand_string = string(int(rand()*100000))","    tmp_m = [join([\"tmp_CGADJ_m1_\",rand_string]);join([\"tmp_CGADJ_m2_\",rand_string]);join([\"tmp_CGADJ_m3_\",rand_string])]","    tmp_d = [join([\"tmp_CGADJ_d1_\",rand_string]);join([\"tmp_CGADJ_d2_\",rand_string]);join([\"tmp_CGADJ_d3_\",rand_string])]","    SeisCopy(m,tmp_m)","    for iop = length(operators) : -1 : 1","        op = operators[iop]","        if (length(methods(op,(Array,Array,Dict{Any,Any}))) > 0)","            op(tmp_m,tmp_d,param)","            SeisCopy(tmp_d,tmp_m)","        else","            for j = 1 : length(m)","                op(tmp_m[j],tmp_d[j],param)","            end    ","            SeisCopy(tmp_d,tmp_m)","        end","    end    ","    SeisCopy(tmp_d,d)","    SeisRemove(tmp_m)","    SeisRemove(tmp_d)","end","","function adjoint_op(m::Array{ASCIIString,1},d::Array{ASCIIString,1},operators,param)","    param[\"adj\"] = true","    rand_string = string(int(rand()*100000))","    tmp_m = [join([\"tmp_CGADJ_m1_\",rand_string]);join([\"tmp_CGADJ_m2_\",rand_string]);join([\"tmp_CGADJ_m3_\",rand_string])]","    tmp_d = [join([\"tmp_CGADJ_d1_\",rand_string]);join([\"tmp_CGADJ_d2_\",rand_string]);join([\"tmp_CGADJ_d3_\",rand_string])]","    SeisCopy(d,tmp_d)","    for iop = 1 : 1 : length(operators)","        op = operators[iop]","        if (length(methods(op,(Array,Array,Dict{Any,Any}))) > 0)","            op(tmp_m,tmp_d,param)","            SeisCopy(tmp_m,tmp_d)","        else","            for j = 1 : length(m)","                op(tmp_m[j],tmp_d[j],param)","            end    ","            SeisCopy(tmp_m,tmp_d)","        end","    end","    SeisCopy(tmp_m,m)","    SeisRemove(tmp_m)","    SeisRemove(tmp_d)","end"]}]}]],"redo":[]}}}